---
ms.date: 06/27/2017
keywords: powershell,cmdlet
title: Windows PowerShell Web 存取的授權規則與安全性功能
ms.openlocfilehash: 07b85a3c7bced58b9ee8db401f0339ba6011bc96
ms.sourcegitcommit: c3f1a83b59484651119630f3089aa51b6e7d4c3c
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/26/2018
ms.locfileid: "39268342"
---
# <a name="authorization-rules-and-security-features-of-windows-powershell-web-access"></a><span data-ttu-id="51149-103">Windows PowerShell Web 存取的授權規則與安全性功能</span><span class="sxs-lookup"><span data-stu-id="51149-103">Authorization Rules and Security Features of Windows PowerShell Web Access</span></span>

<span data-ttu-id="51149-104">更新日期︰2013 年 6 月 24 日</span><span class="sxs-lookup"><span data-stu-id="51149-104">Updated: June 24, 2013</span></span>

<span data-ttu-id="51149-105">適用目標︰Windows Server 2012 R2、Windows Server 2012</span><span class="sxs-lookup"><span data-stu-id="51149-105">Applies To: Windows Server 2012 R2, Windows Server 2012</span></span>

<span data-ttu-id="51149-106">Windows Server 2012 R2 和 Windows Server 2012 中的 Windows PowerShell Web 存取具有受限制的安全性模型。</span><span class="sxs-lookup"><span data-stu-id="51149-106">Windows PowerShell Web Access in Windows Server 2012 R2 and Windows Server 2012 has a restrictive security model.</span></span> <span data-ttu-id="51149-107">您必須明確授與使用者存取權，他們才能登入 Windows PowerShell Web 存取閘道並使用網頁型 Windows PowerShell 主控台。</span><span class="sxs-lookup"><span data-stu-id="51149-107">Users must explicitly be granted access before they can sign in to the Windows PowerShell Web Access gateway and use the web-based Windows PowerShell console.</span></span>

## <a name="configuring-authorization-rules-and-site-security"></a><span data-ttu-id="51149-108">設定授權規則及站台安全性</span><span class="sxs-lookup"><span data-stu-id="51149-108">Configuring authorization rules and site security</span></span>

<span data-ttu-id="51149-109">安裝 Windows PowerShell Web 存取並設定閘道之後，使用者就可以在瀏覽器中開啟登入頁面，但是必須等到 Windows PowerShell Web 存取系統管理員明確授與使用者存取權之後，才能登入。</span><span class="sxs-lookup"><span data-stu-id="51149-109">After Windows PowerShell Web Access is installed and the gateway is configured, users can open the sign-in page in a browser, but they cannot sign in until the Windows PowerShell Web Access administrator grants users access explicitly.</span></span> <span data-ttu-id="51149-110">您可以使用下表所述的 Windows PowerShell Cmdlet，來管理「Windows PowerShell Web 存取」存取控制。</span><span class="sxs-lookup"><span data-stu-id="51149-110">'Windows PowerShell Web Access' access control is managed by using the set of Windows PowerShell cmdlets described in the following table.</span></span> <span data-ttu-id="51149-111">沒有適用於新增或管理授權規則的 GUI。</span><span class="sxs-lookup"><span data-stu-id="51149-111">There is no comparable GUI for adding or managing authorization rules.</span></span>
<span data-ttu-id="51149-112">請參閱 [Windows PowerShell Web 存取 Cmdlet](cmdlets/web-access-cmdlets.md)。</span><span class="sxs-lookup"><span data-stu-id="51149-112">See [Windows PowerShell Web Access Cmdlets](cmdlets/web-access-cmdlets.md).</span></span>

<span data-ttu-id="51149-113">系統管理員可以為 Windows PowerShell Web 存取定義 `{0-n}` 個驗證規則。</span><span class="sxs-lookup"><span data-stu-id="51149-113">Administrators can define `{0-n}` authentication rules for Windows PowerShell Web Access.</span></span> <span data-ttu-id="51149-114">預設的安全性是用來限制動作而不是允許動作；零驗證規則表示沒有任何使用者有權存取任何內容。</span><span class="sxs-lookup"><span data-stu-id="51149-114">The default security is restrictive rather than permissive; zero authentication rules means no users have access to anything.</span></span>

<span data-ttu-id="51149-115">Windows Server 2012 R2 中的 [Add-PswaAuthorizationRule](cmdlets/add-pswaauthorizationrule.md) 和 [Test-PswaAuthorizationRule](cmdlets/test-pswaauthorizationrule.md) 包含可讓您從遠端電腦或從作用中的 Windows PowerShell Web 存取工作階段，新增和測試 Windows PowerShell Web 存取授權規則的 Credential 參數。</span><span class="sxs-lookup"><span data-stu-id="51149-115">[Add-PswaAuthorizationRule](cmdlets/add-pswaauthorizationrule.md) and [Test-PswaAuthorizationRule](cmdlets/test-pswaauthorizationrule.md) in Windows Server 2012 R2 include a Credential parameter that allows you to add and test Windows PowerShell Web Access authorization rules from a remote computer, or from within an active Windows PowerShell Web Access session.</span></span> <span data-ttu-id="51149-116">如同其他具有 Credential 參數的 Windows PowerShell Cmdlet，您可以將 PSCredential 物件指定為此參數的值。</span><span class="sxs-lookup"><span data-stu-id="51149-116">As with other Windows PowerShell cmdlets that have a Credential parameter, you can specify a PSCredential object as the value of the parameter.</span></span> <span data-ttu-id="51149-117">若要建立 PSCredential 物件且包含您要傳遞至遠端電腦的認證，請執行 [Get-Credential](/powershell/module/microsoft.powershell.security/Get-Credential) Cmdlet。</span><span class="sxs-lookup"><span data-stu-id="51149-117">To create a PSCredential object that contains credentials you want to pass to a remote computer, run the [Get-Credential](/powershell/module/microsoft.powershell.security/Get-Credential) cmdlet.</span></span>

<span data-ttu-id="51149-118">Windows PowerShell Web 存取驗證規則是允許清單規則。</span><span class="sxs-lookup"><span data-stu-id="51149-118">Windows PowerShell Web Access authentication rules are whitelist rules.</span></span> <span data-ttu-id="51149-119">每個規則都是使用者、目標電腦及指定目標電腦上特定 Windows PowerShellÂ [工作階段設定](/powershell/reference/5.1/microsoft.powershell.core/about/about_session_configurations) (也稱為端點或 _Runspace_) 間允許連線的定義。</span><span class="sxs-lookup"><span data-stu-id="51149-119">Each rule is a definition of an allowed connection between users, target computers, and particular Windows PowerShellÂ [session configurations](/powershell/reference/5.1/microsoft.powershell.core/about/about_session_configurations) (also referred to as endpoints or _runspaces_) on specified target computers.</span></span>
<span data-ttu-id="51149-120">如需 **Runspace** 的說明，請參閱 [Beginning Use of PowerShell Runspaces](https://blogs.technet.microsoft.com/heyscriptingguy/2015/11/26/beginning-use-of-powershell-runspaces-part-1/) (開始使用 PowerShell Runspace)</span><span class="sxs-lookup"><span data-stu-id="51149-120">For an explanation on **runspaces** see [Beginning Use of PowerShell Runspaces](https://blogs.technet.microsoft.com/heyscriptingguy/2015/11/26/beginning-use-of-powershell-runspaces-part-1/)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="51149-121">只要一個規則為真，使用者就可以進行存取。</span><span class="sxs-lookup"><span data-stu-id="51149-121">A user needs only one rule to be true to get access.</span></span> <span data-ttu-id="51149-122">如果已為使用者授與某部電腦的存取權 (無論是完整語言存取或只能存取 Windows PowerShell 遠端管理 Cmdlet)，使用者都可以從網頁型主控台登入 (或跳躍) 至已與第一部目標電腦連線的其他電腦。</span><span class="sxs-lookup"><span data-stu-id="51149-122">If a user is given access to one computer with either full language access or access only to Windows PowerShell remote management cmdlets, from the web-based console, the user can log on (or hop) to other computers that are connected to the first target computer.</span></span> <span data-ttu-id="51149-123">設定 Windows PowerShell Web 存取最安全的方法就是只允許使用者存取受限制的工作階段設定，讓他們能夠完成通常需要遠端執行的特定工作。</span><span class="sxs-lookup"><span data-stu-id="51149-123">The most secure way to configure Windows PowerShell Web Access is to allow users access only to constrained session configurations that allow them to accomplish specific tasks that they normally need to perform remotely.</span></span>

<span data-ttu-id="51149-124">[Windows PowerShell Web 存取 Cmdlet](cmdlets/web-access-cmdlets.md) 中參考的 Cmdlet 可讓您建立一組存取規則，用來為 Windows PowerShell Web 存取閘道上的使用者授與權限。</span><span class="sxs-lookup"><span data-stu-id="51149-124">The cmdlets referenced in [Windows PowerShell Web Access Cmdlets](cmdlets/web-access-cmdlets.md) allow to create a set of access rules which are used to authorize a user on the Windows PowerShell Web Access gateway.</span></span> <span data-ttu-id="51149-125">這些規則與目的地電腦上的存取控制清單 (ACL) 不同，且可以為 Web 存取提供額外的安全性。</span><span class="sxs-lookup"><span data-stu-id="51149-125">The rules are different from the access control lists (ACLs) on the destination computer, and provide an additional layer of security for web access.</span></span> <span data-ttu-id="51149-126">下節將有更詳細的安全性說明。</span><span class="sxs-lookup"><span data-stu-id="51149-126">More details about security are described in the following section.</span></span>

<span data-ttu-id="51149-127">如果使用者無法通過上述任何安全性階層，他們會在瀏覽器視窗收到一般「拒絕存取」訊息。</span><span class="sxs-lookup"><span data-stu-id="51149-127">If users cannot pass any of the preceding security layers, they receive a generic 'access denied' message in their browser windows.</span></span> <span data-ttu-id="51149-128">雖然閘道伺服器會記錄安全性細節，但是不會對一般使用者顯示他們通過多少安全性階層，或在哪一個階層發生登入或驗證失敗。</span><span class="sxs-lookup"><span data-stu-id="51149-128">Although security details are logged on the gateway server, end users are not shown information about how many security layers they passed, or at which layer the sign-in or authentication failure occurred.</span></span>

<span data-ttu-id="51149-129">如需設定授權規則的詳細資訊，請參閱本主題中的[設定授權規則](#configuring-authorization-rules-and-site-security)。</span><span class="sxs-lookup"><span data-stu-id="51149-129">For more information about configuring authorization rules, see [configuring authorization rules](#configuring-authorization-rules-and-site-security) in this topic.</span></span>

### <a name="security"></a><span data-ttu-id="51149-130">安全性</span><span class="sxs-lookup"><span data-stu-id="51149-130">Security</span></span>

<span data-ttu-id="51149-131">Windows PowerShell Web 存取安全性模型在網頁型主控台的一般使用者與目標電腦之間有四個階層。</span><span class="sxs-lookup"><span data-stu-id="51149-131">The Windows PowerShell Web Access security model has four layers between an end user of the web-based console, and a target computer.</span></span> <span data-ttu-id="51149-132">Windows PowerShell Web 存取系統管理員可以在 IIS 管理員主控台中，透過其他設定來增加安全性階層。</span><span class="sxs-lookup"><span data-stu-id="51149-132">Windows PowerShell Web Access administrators can add security layers through additional configuration in the IIS Manager console.</span></span> <span data-ttu-id="51149-133">如需在 IIS 管理員主控台中保護網站安全的詳細資訊，請參閱[設定網頁伺服器安全性 (IIS 7)](https://technet.microsoft.com/library/cc731278) \(英文\)。</span><span class="sxs-lookup"><span data-stu-id="51149-133">For more information about securing websites in the IIS Manager console, see [Configure Web Server Security (IIS7)](https://technet.microsoft.com/library/cc731278).</span></span>

<span data-ttu-id="51149-134">如需 IIS 最佳做法及防止拒絕服務攻擊的詳細資訊，請參閱[防止 DoS/拒絕服務攻擊的最佳做法](https://technet.microsoft.com/library/cc750213)。</span><span class="sxs-lookup"><span data-stu-id="51149-134">For more information about IIS best practices and preventing denial-of-service attacks, see [Best Practices for Preventing DoS/Denial of Service Attacks](https://technet.microsoft.com/library/cc750213).</span></span>
<span data-ttu-id="51149-135">系統管理員也可以購買並安裝其他零售的驗證軟體。</span><span class="sxs-lookup"><span data-stu-id="51149-135">An administrator can also buy and install additional retail authentication software.</span></span>

<span data-ttu-id="51149-136">下表說明一般使用者與目標電腦之間的四個安全性階層。</span><span class="sxs-lookup"><span data-stu-id="51149-136">The following table describes the four layers of security between end users and target computers.</span></span>

|<span data-ttu-id="51149-137">層級</span><span class="sxs-lookup"><span data-stu-id="51149-137">Level</span></span>|<span data-ttu-id="51149-138">階層</span><span class="sxs-lookup"><span data-stu-id="51149-138">Layer</span></span>|
|-|-|
|<span data-ttu-id="51149-139">1</span><span class="sxs-lookup"><span data-stu-id="51149-139">1</span></span>|[<span data-ttu-id="51149-140">IIS 網頁伺服器安全性功能</span><span class="sxs-lookup"><span data-stu-id="51149-140">iis web server security features</span></span>](#iis-web-server-security-features)|
|<span data-ttu-id="51149-141">2</span><span class="sxs-lookup"><span data-stu-id="51149-141">2</span></span>|[<span data-ttu-id="51149-142">Windows PowerShell Web 存取表單型閘道驗證</span><span class="sxs-lookup"><span data-stu-id="51149-142">windows powershell web access forms-based gateway authentication</span></span>](#windows-powershell-web-access-forms-based-gateway-authentication)|
|<span data-ttu-id="51149-143">3</span><span class="sxs-lookup"><span data-stu-id="51149-143">3</span></span>|[<span data-ttu-id="51149-144">Windows PowerShell Web 存取授權規則</span><span class="sxs-lookup"><span data-stu-id="51149-144">windows powershell web access authorization rules</span></span>](#windows-powershell-web-access-authorization-rules)|
|<span data-ttu-id="51149-145">4</span><span class="sxs-lookup"><span data-stu-id="51149-145">4</span></span>|[<span data-ttu-id="51149-146">目標驗證及授權規則</span><span class="sxs-lookup"><span data-stu-id="51149-146">target authentication and authorization rules</span></span>](#target-authentication-and-authorization-rules)|

<span data-ttu-id="51149-147">您可以在下列標題下找到每個階層的詳細資訊：</span><span class="sxs-lookup"><span data-stu-id="51149-147">Detailed information about each layer can be found under the following headings:</span></span>

#### <a name="iis-web-server-security-features"></a><span data-ttu-id="51149-148">IIS 網頁伺服器安全性功能</span><span class="sxs-lookup"><span data-stu-id="51149-148">IIS Web Server security features</span></span>

<span data-ttu-id="51149-149">Windows PowerShell Web 存取使用者一律必須提供使用者名稱及密碼，才能在閘道上驗證他們的帳戶。</span><span class="sxs-lookup"><span data-stu-id="51149-149">Windows PowerShell Web Access users must always provide a user name and password to authenticate their accounts on the gateway.</span></span> <span data-ttu-id="51149-150">不過，Windows PowerShell Web 存取系統管理員也可以開啟或關閉選擇性的用戶端憑證驗證 (請參閱[安裝和使用 Windows PowerShell Web 存取](install-and-use-windows-powershell-web-access.md)以啟用測試憑證，並在稍後了解如何設定正版憑證)。</span><span class="sxs-lookup"><span data-stu-id="51149-150">However, Windows PowerShell Web Access administrators can also turn optional client certificate authentication on or off, see [install and use windows powershell web access](install-and-use-windows-powershell-web-access.md) to enable a test certificate and, later, how to configure a genuine certificate).</span></span>

<span data-ttu-id="51149-151">選擇性用戶端憑證功能要求一般使用者除了使用者名稱及密碼之外還需具備有效的用戶端憑證，而這也是網頁伺服器 (IIS) 設定的一部份。</span><span class="sxs-lookup"><span data-stu-id="51149-151">The optional client certificate feature requires end users to have a valid client certificate, in addition to their user names and passwords, and is part of Web Server (IIS) configuration.</span></span> <span data-ttu-id="51149-152">啟用用戶端憑證層時，Windows PowerShell Web 存取登入頁面會提示使用者提供有效的憑證，才能評估他們的登入認證。</span><span class="sxs-lookup"><span data-stu-id="51149-152">When the client certificate layer is enabled, the Windows PowerShell Web Access sign-in page prompts users to provide valid certificates before their sign-in credentials are evaluated.</span></span> <span data-ttu-id="51149-153">用戶端憑證驗證會自動檢查用戶端憑證。</span><span class="sxs-lookup"><span data-stu-id="51149-153">Client certificate authentication automatically checks for the client certificate.</span></span> <span data-ttu-id="51149-154">如果找不到有效的憑證，Windows PowerShell Web 存取會通知使用者，讓使用者可以提供憑證。</span><span class="sxs-lookup"><span data-stu-id="51149-154">If a valid certificate is not found, Windows PowerShell Web Access informs users, so they can provide the certificate.</span></span> <span data-ttu-id="51149-155">如果找到有效的用戶端憑證，Windows PowerShell Web 存取會為使用者開啟登入頁面，讓他們提供使用者名稱及密碼。</span><span class="sxs-lookup"><span data-stu-id="51149-155">If a valid client certificate is found, Windows PowerShell Web Access opens the sign-in page for users to provide their user names and passwords.</span></span>

<span data-ttu-id="51149-156">這是 IIS 網頁伺服器提供額外安全性設定的範例。</span><span class="sxs-lookup"><span data-stu-id="51149-156">This is one example of additional security settings that are offered by IIS Web Server.</span></span> <span data-ttu-id="51149-157">如需其他 IIS 安全性功能的詳細資訊，請參閱[設定網頁伺服器安全性 (IIS 7)](https://technet.microsoft.com/library/cc731278)。</span><span class="sxs-lookup"><span data-stu-id="51149-157">For more information about other IIS security features, see [Configure Web Server Security (IIS 7)](https://technet.microsoft.com/library/cc731278).</span></span>

#### <a name="windows-powershell-web-access-forms-based-gateway-authentication"></a><span data-ttu-id="51149-158">Windows PowerShell Web 存取表單型閘道驗證</span><span class="sxs-lookup"><span data-stu-id="51149-158">Windows PowerShell Web Access forms-based gateway authentication</span></span>

<span data-ttu-id="51149-159">Windows PowerShell Web 存取登入頁面會要求一組認證 (使用者名稱及密碼)，並提供選項，讓使用者為目標電腦提供不同的認證。</span><span class="sxs-lookup"><span data-stu-id="51149-159">The Windows PowerShell Web Access sign-in page requires a set of credentials (user name and password) and offers users the option of providing different credentials for the target computer.</span></span>
<span data-ttu-id="51149-160">如果使用者沒有提供替代認證，就會使用連線閘道的主要使用者名稱及密碼來連線目標電腦。</span><span class="sxs-lookup"><span data-stu-id="51149-160">If the user does not provide alternate credentials, the primary user name and password that are used to connect to the gateway are also used to connect to the target computer.</span></span>

<span data-ttu-id="51149-161">所需的認證會在 Windows PowerShell Web 存取閘道上進行驗證。</span><span class="sxs-lookup"><span data-stu-id="51149-161">The required credentials are authenticated on the Windows PowerShell Web Access gateway.</span></span> <span data-ttu-id="51149-162">這些認證必須是本機 Windows PowerShell Web 存取閘道伺服器上或 Active Directory 中的有效使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="51149-162">These credentials must be valid user accounts on either the local Windows PowerShell Web Access gateway server, or in Active Directory.</span></span>

#### <a name="windows-powershell-web-access-authorization-rules"></a><span data-ttu-id="51149-163">Windows PowerShell Web 存取授權規則</span><span class="sxs-lookup"><span data-stu-id="51149-163">Windows PowerShell Web Access authorization rules</span></span>

<span data-ttu-id="51149-164">當使用者通過閘道上的驗證之後，Windows PowerShell Web 存取會檢查授權規則，以確定使用者是否有權存取要求的目標電腦。</span><span class="sxs-lookup"><span data-stu-id="51149-164">After a user is authenticated at the gateway, Windows PowerShell Web Access checks authorization rules to verify if the user has access to the requested target computer.</span></span> <span data-ttu-id="51149-165">成功授權之後，使用者的認證就會傳送到目標電腦。</span><span class="sxs-lookup"><span data-stu-id="51149-165">After successful authorization, the user's credentials are passed along to the target computer.</span></span>

<span data-ttu-id="51149-166">只有在使用者通過閘道驗證之後，目標電腦驗證使用者之前，才會評估這些規則。</span><span class="sxs-lookup"><span data-stu-id="51149-166">These rules are evaluated only after a user has been authenticated by the gateway, and before a user can be authenticated on a target computer.</span></span>

#### <a name="target-authentication-and-authorization-rules"></a><span data-ttu-id="51149-167">目標驗證及授權規則</span><span class="sxs-lookup"><span data-stu-id="51149-167">Target authentication and authorization rules</span></span>

<span data-ttu-id="51149-168">Windows PowerShell Web 存取的最終安全性階層是目標電腦本身的安全性設定。</span><span class="sxs-lookup"><span data-stu-id="51149-168">The final layer of security for Windows PowerShell Web Access is the target computer's own security configuration.</span></span> <span data-ttu-id="51149-169">使用者必須在目標電腦上及 Windows PowerShell Web 存取授權規則中設定適當的存取權，才能執行 Windows PowerShell 網頁型主控台，透過 Windows PowerShell Web 存取來影響目標電腦。</span><span class="sxs-lookup"><span data-stu-id="51149-169">Users must have the appropriate access rights configured on the target computer, and also in the Windows PowerShell Web Access authorization rules, to run a Windows PowerShell web-based console that affects a target computer through Windows PowerShell Web Access.</span></span>

<span data-ttu-id="51149-170">這個階層提供的安全性機制，與使用者嘗試在 Windows PowerShell 內執行 [Enter-PSSession](/powershell/module/microsoft.powershell.core/Enter-PSSession) 或 [New-PSSession](/powershell/module/microsoft.powershell.core/new-pssession) Cmdlet，以建立目標電腦的遠端 Windows PowerShell 工作階段時所用的評估連線嘗試安全性機制相同。</span><span class="sxs-lookup"><span data-stu-id="51149-170">This layer offers the same security mechanisms that would evaluate connection attempts if users tried to create a remote Windows PowerShell session to a target computer from within Windows PowerShell by running the [Enter-PSSession](/powershell/module/microsoft.powershell.core/Enter-PSSession) or [New-PSSession](/powershell/module/microsoft.powershell.core/new-pssession) cmdlets.</span></span>

<span data-ttu-id="51149-171">根據預設，Windows PowerShell Web 存取在閘道及目標電腦上都會使用主要的使用者名稱和密碼進行驗證。</span><span class="sxs-lookup"><span data-stu-id="51149-171">By default, Windows PowerShell Web Access uses the primary user name and password for authentication on both the gateway and the target computer.</span></span> <span data-ttu-id="51149-172">網頁型登入頁面會在標題為**選用連線設定**的區段中提供選項，讓使用者可視需要為目標電腦提供不同的認證。</span><span class="sxs-lookup"><span data-stu-id="51149-172">The web-based sign-in page, in a section titled **Optional connection settings**, offers users the option of providing different credentials for the target computer, if they are required.</span></span> <span data-ttu-id="51149-173">如果使用者沒有提供替代認證，就會使用連線閘道的主要使用者名稱及密碼來連線目標電腦。</span><span class="sxs-lookup"><span data-stu-id="51149-173">If the user does not provide alternate credentials, the primary user name and password that are used to connect to the gateway are also used to connect to the target computer.</span></span>

<span data-ttu-id="51149-174">授權規則可用來允許使用者存取特定工作階段設定。</span><span class="sxs-lookup"><span data-stu-id="51149-174">Authorization rules can be used to allow users access to a particular session configuration.</span></span> <span data-ttu-id="51149-175">您可以為 Windows PowerShell Web 存取建立_受限制的 Runspace_ 或工作階段設定，並允許特定使用者在登入 Windows PowerShell Web 存取時只能連線到特定的工作階段設定。</span><span class="sxs-lookup"><span data-stu-id="51149-175">You can create _restricted runspaces_ or session configurations for Windows PowerShell Web Access, and allow specific users to connect only to specific session configurations when they sign in to Windows PowerShell Web Access.</span></span> <span data-ttu-id="51149-176">您可以使用存取控制清單 (ACL) 來判斷哪些使用者有權存取特定端點，然後使用本節描述的授權規則進一步限制特定使用者組的端點存取權。</span><span class="sxs-lookup"><span data-stu-id="51149-176">You can use access control lists (ACLs) to determine which users have access to specific endpoints, and further restrict access to the endpoint for a specific set of users by using authorization rules described in this section.</span></span> <span data-ttu-id="51149-177">如需受限制之 Runspace 的詳細資訊，請參閱 [Creating a constrained runspace](https://msdn.microsoft.com/library/dn614668) (建立受限制的 Runspace)。</span><span class="sxs-lookup"><span data-stu-id="51149-177">For more information about restricted runspaces, see [Creating a constrained runspace](https://msdn.microsoft.com/library/dn614668).</span></span>

### <a name="configuring-authorization-rules"></a><span data-ttu-id="51149-178">設定授權規則</span><span class="sxs-lookup"><span data-stu-id="51149-178">Configuring authorization rules</span></span>

<span data-ttu-id="51149-179">系統管理員很可能想要針對 Windows PowerShell Web 存取使用者，將已在其環境中定義的同一個授權規則套用到 Windows PowerShell 遠端管理。</span><span class="sxs-lookup"><span data-stu-id="51149-179">Administrators likely want the same authorization rule for Windows PowerShell Web Access users that is already defined in their environment for Windows PowerShell remote management.</span></span> <span data-ttu-id="51149-180">本節的第一個程序描述如何新增授與一位使用者存取權、登入以管理一部電腦，以及單一工作階段設定內的安全性規則。</span><span class="sxs-lookup"><span data-stu-id="51149-180">The first procedure in this section describes how to add a secure authorization rule that grants access to one user, signing in to manage one computer, and within a single session configuration.</span></span> <span data-ttu-id="51149-181">第二個程序描述如何移除不再需要的授權規則。</span><span class="sxs-lookup"><span data-stu-id="51149-181">The second procedure describes how to remove an authorization rule that is no longer needed.</span></span>

<span data-ttu-id="51149-182">如果您打算使用自訂工作階段設定來允許特定使用者只能在 Windows PowerShell Web 存取中受限制的 Runspace 內工作，請先建立您的自訂工作階段設定，然後再新增參考這些設定的授權規則。</span><span class="sxs-lookup"><span data-stu-id="51149-182">If you plan to use custom session configurations to allow specific users to work only within restricted runspaces in Windows PowerShell Web Access, create your custom session configurations before you add authorization rules that refer to them.</span></span> <span data-ttu-id="51149-183">您不能使用 Windows PowerShell Web 存取 Cmdlet 來建立自訂的工作階段設定。</span><span class="sxs-lookup"><span data-stu-id="51149-183">You cannot use the Windows PowerShell Web Access cmdlets to create custom session configurations.</span></span> <span data-ttu-id="51149-184">如需建立自訂工作階段設定的詳細資訊，請參閱 [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configuration_files) \(英文\)。</span><span class="sxs-lookup"><span data-stu-id="51149-184">For more information about creating custom session configurations, see [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configuration_files).</span></span>

<span data-ttu-id="51149-185">Windows PowerShell Web 存取 Cmdlet 支援一個萬用字元，也就是星號 ( \* )。</span><span class="sxs-lookup"><span data-stu-id="51149-185">Windows PowerShell Web Access cmdlets support one wildcard character, an asterisk ( \* ).</span></span> <span data-ttu-id="51149-186">不支援在字串中使用萬用字元；每一個屬性 (使用者、電腦或工作階段設定) 使用單一星號。</span><span class="sxs-lookup"><span data-stu-id="51149-186">Wildcard characters within strings are not supported; use a single asterisk per property (users, computers, or session configurations).</span></span>

> [!NOTE]
> <span data-ttu-id="51149-187">如需更多您可以使用授權規則來授與使用者存取權及協助保護 Windows PowerShell Web 存取環境的方法，請參閱本主題中的[其他授權規則案例範例](#other-authorization-rule-scenario-examples)。</span><span class="sxs-lookup"><span data-stu-id="51149-187">For more ways you can use authorization rules to grant access to users and help secure the Windows PowerShell Web Access environment, see [other authorization rule scenario examples](#other-authorization-rule-scenario-examples) in this topic.</span></span>

#### <a name="to-add-a-restrictive-authorization-rule"></a><span data-ttu-id="51149-188">新增限制性授權規則</span><span class="sxs-lookup"><span data-stu-id="51149-188">To add a restrictive authorization rule</span></span>

1. <span data-ttu-id="51149-189">執行下列其中一個動作，使用提高的使用者權限開啟 Windows PowerShell 工作階段。</span><span class="sxs-lookup"><span data-stu-id="51149-189">Do one of the following to open a Windows PowerShell session with elevated user rights.</span></span>

   - <span data-ttu-id="51149-190">在 Windows 桌面上，以滑鼠右鍵按一下工作列上的 **[Windows PowerShell]**，然後按一下 **[以系統管理員身分執行]**。</span><span class="sxs-lookup"><span data-stu-id="51149-190">On the Windows desktop, right-click **Windows PowerShell** on the taskbar, and then click **Run as Administrator**.</span></span>

   - <span data-ttu-id="51149-191">在 Windows **[開始]** 畫面上，以滑鼠右鍵按一下 **[Windows PowerShell]**，然後按一下 **[以系統管理員身分執行]**。</span><span class="sxs-lookup"><span data-stu-id="51149-191">On the Windows **Start** screen, right-click **Windows PowerShell**, and then click **Run as Administrator**.</span></span>

2. <span data-ttu-id="51149-192">**選擇性步驟**：若要使用工作階段設定限制使用者存取：</span><span class="sxs-lookup"><span data-stu-id="51149-192">**Optional step** For restricting user access by using session configurations:</span></span>

   <span data-ttu-id="51149-193">確認您要使用的工作階段設定已存在於規則中。</span><span class="sxs-lookup"><span data-stu-id="51149-193">Verify that the session configurations that you want to use, already exist in your rules .</span></span>

   <span data-ttu-id="51149-194">如果尚未建立這些設定，請使用 [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configuration_files) 中建立工作階段設定的指示。</span><span class="sxs-lookup"><span data-stu-id="51149-194">If they have not yet been created, use instructions for creating session configurations in [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configuration_files).</span></span>

3. <span data-ttu-id="51149-195">這個授權規則允許特定使用者存取網路 (他們通常擁有其存取權) 上的一部電腦，並能夠存取範圍是使用者一般指令碼編寫及 cmdlet 需求的特定工作階段設定。</span><span class="sxs-lookup"><span data-stu-id="51149-195">This authorization rule allows a specific user access to one computer on the network to which they typically have access, with access to a specific session configuration that is scoped to the user'™s typical scripting and cmdlet needs.</span></span> <span data-ttu-id="51149-196">輸入下列程式碼，然後按 **Enter**。</span><span class="sxs-lookup"><span data-stu-id="51149-196">Type the following, and then press **Enter**.</span></span>

   ```
   Add-PswaAuthorizationRule -UserName <domain\user | computer\user> `
      -ComputerName <computer_name> -ConfigurationName <session_configuration_name>
   ```

   - <span data-ttu-id="51149-197">在下列範例中，_Contoso_ 網域中名為 _JSmith_ 的使用者會被授與管理電腦 _Contoso_214_ 的存取權，並使用名為 _NewAdminsOnly_ 的工作階段設定。</span><span class="sxs-lookup"><span data-stu-id="51149-197">In the following example, a user named _JSmith_ in the _Contoso_ domain is granted access to manage the computer _Contoso_214_, and use a session configuration named _NewAdminsOnly_.</span></span>

   ```powershell
   Add-PswaAuthorizationRule -UserName 'Contoso\JSmith' `
      -ComputerName Contoso_214 -ConfigurationName NewAdminsOnly
   ```

4. <span data-ttu-id="51149-198">透過執行 **Get-PswaAuthorizationRule** Cmdlet 或 `Test-PswaAuthorizationRule -UserName <domain\user | computer\user> -ComputerName** <computer_name>` 來確認已建立規則。</span><span class="sxs-lookup"><span data-stu-id="51149-198">Verify that the rule has been created by running either the **Get-PswaAuthorizationRule** cmdlet, or `Test-PswaAuthorizationRule -UserName <domain\user | computer\user> -ComputerName** <computer_name>`.</span></span>
   <span data-ttu-id="51149-199">例如，`Test-PswaAuthorizationRule -UserName Contoso\\JSmith -ComputerName Contoso_214`。</span><span class="sxs-lookup"><span data-stu-id="51149-199">For example, `Test-PswaAuthorizationRule -UserName Contoso\\JSmith -ComputerName Contoso_214`.</span></span>

#### <a name="to-remove-an-authorization-rule"></a><span data-ttu-id="51149-200">移除授權規則</span><span class="sxs-lookup"><span data-stu-id="51149-200">To remove an authorization rule</span></span>

1. <span data-ttu-id="51149-201">如果尚未開啟 Windows PowerShell 工作階段，請參閱本節中[新增限制性授權規則](#to-add-a-restrictive-authorization-rule)的步驟 1。</span><span class="sxs-lookup"><span data-stu-id="51149-201">If a Windows PowerShell session is not already open, see step 1 of [to add a restrictive authorization rule](#to-add-a-restrictive-authorization-rule) in this section.</span></span>

2. <span data-ttu-id="51149-202">輸入下列資訊，然後按下 **Enter**，其中 *rule ID* 代表您想要移除之規則的唯一識別碼。</span><span class="sxs-lookup"><span data-stu-id="51149-202">Type the following, and then press **Enter**, where *rule ID* represents the unique ID number of the rule that you want to remove.</span></span>

   ```
   Remove-PswaAuthorizationRule -ID <rule ID>
   ```

   <span data-ttu-id="51149-203">或者，如果您不知道識別碼，但是知道您想要移除之規則的好記名稱，您可以取得規則的名稱，將它傳送到 `Remove-PswaAuthorizationRule` Cmdlet 來移除規則，如下列範例所示：</span><span class="sxs-lookup"><span data-stu-id="51149-203">Alternatively, if you do not know the ID number, but know the friendly name of the rule you want to remove, you can get the name of the rule, and pipe it to the `Remove-PswaAuthorizationRule` cmdlet to remove the rule, as shown in the following example:</span></span>

   ```
   Get-PswaAuthorizationRule `
      -RuleName <rule-name> | Remove-PswaAuthorizationRule
  ```

> [!NOTE]
> <span data-ttu-id="51149-204">系統不會提示您確認是否要刪除指定的授權規則；當您按下 **Enter** 時就會刪除該規則。</span><span class="sxs-lookup"><span data-stu-id="51149-204">You are not prompted to confirm whether you want to delete the specified authorization rule; the rule is deleted when you press **Enter**.</span></span> <span data-ttu-id="51149-205">執行 `Remove-PswaAuthorizationRule` Cmdlet 之前，請先確定您要移除該授權規則。</span><span class="sxs-lookup"><span data-stu-id="51149-205">Be sure that you want to remove the authorization rule before running the `Remove-PswaAuthorizationRule` cmdlet.</span></span>

#### <a name="other-authorization-rule-scenario-examples"></a><span data-ttu-id="51149-206">其他授權規則案例</span><span class="sxs-lookup"><span data-stu-id="51149-206">Other authorization rule scenario examples</span></span>

<span data-ttu-id="51149-207">每一個 Windows PowerShell 工作階段都會使用一個工作階段設定；如果未針對工作階段指定這類設定，Windows PowerShell 就會使用預設的內建 Windows PowerShell 工作階段設定 (稱為 Microsoft.PowerShell)。</span><span class="sxs-lookup"><span data-stu-id="51149-207">Every Windows PowerShell session uses a session configuration; if one is not specified for a session, Windows PowerShell uses the default, built-in Windows PowerShell session configuration, called Microsoft.PowerShell.</span></span> <span data-ttu-id="51149-208">預設的工作階段設定包含電腦可用的所有 Cmdlet。</span><span class="sxs-lookup"><span data-stu-id="51149-208">The default session configuration includes all cmdlets that are available on a computer.</span></span> <span data-ttu-id="51149-209">系統管理員可以使用受限制的 Runspace (一般使用者可以執行之有限範圍內的 Cmdlet 及工作) 來定義工作階段設定，以便限制所有電腦的存取權。</span><span class="sxs-lookup"><span data-stu-id="51149-209">Administrators can restrict access to all computers by defining a session configuration with a restricted runspace (a limited range of cmdlets and tasks that their end users could perform).</span></span> <span data-ttu-id="51149-210">如果已為使用者授與某部電腦的存取權 (無論完整的語言存取權或只能存取 Windows PowerShell 遠端管理 Cmdlet)，該使用者就能連線到已與第一部電腦連線的其他電腦。</span><span class="sxs-lookup"><span data-stu-id="51149-210">A user who is granted access to one computer with either full language access or only the Windows PowerShell remote management cmdlets can connect to other computers that are connected to the first computer.</span></span> <span data-ttu-id="51149-211">定義受限制的 Runspace 可防止使用者從他們允許的 Windows PowerShell Runspace 存取其他電腦，而且還可以提升 Windows PowerShell Web 存取環境的安全性。</span><span class="sxs-lookup"><span data-stu-id="51149-211">Defining a restricted runspace can prevent users from accessing other computers from their allowed Windows PowerShell runspace, and improves the security of your Windows PowerShell Web Access environment.</span></span> <span data-ttu-id="51149-212">工作階段設定可以散佈 (使用群組原則) 到系統管理員想要透過 Windows PowerShell Web 存取來存取的所有電腦。</span><span class="sxs-lookup"><span data-stu-id="51149-212">The session configuration can be distributed (by using Group Policy) to all computers that administrators want to make accessible through Windows PowerShell Web Access.</span></span> <span data-ttu-id="51149-213">如需工作階段設定的詳細資訊，請參閱 [about_Session_Configurations](https://technet.microsoft.com/library/dd819508.aspx)。</span><span class="sxs-lookup"><span data-stu-id="51149-213">For more information about session configurations, see [about_Session_Configurations](https://technet.microsoft.com/library/dd819508.aspx).</span></span> <span data-ttu-id="51149-214">下面是這個案例的一些範例。</span><span class="sxs-lookup"><span data-stu-id="51149-214">The following are some examples of this scenario.</span></span>

- <span data-ttu-id="51149-215">系統管理員會建立一個含有受限制 Runspace 的端點，稱為 **PswaEndpoint**。</span><span class="sxs-lookup"><span data-stu-id="51149-215">An administrator creates an endpoint, called **PswaEndpoint**, with a restricted runspace.</span></span> <span data-ttu-id="51149-216">然後，系統管理員會建立 `*,*,PswaEndpoint` 規則，並將該端點散佈到其他電腦。</span><span class="sxs-lookup"><span data-stu-id="51149-216">Then, the administrator creates a rule, `*,*,PswaEndpoint`, and distributes the endpoint to other computers.</span></span> <span data-ttu-id="51149-217">這個規則允許所有使用者存取具有端點 **PswaEndpoint** 的所有電腦。</span><span class="sxs-lookup"><span data-stu-id="51149-217">The rule allows all users to access all computers with the endpoint **PswaEndpoint**.</span></span>
  <span data-ttu-id="51149-218">如果這是規則集中定義的唯一授權規則，就無法存取不具該端點的電腦。</span><span class="sxs-lookup"><span data-stu-id="51149-218">If this is the only authorization rule defined in the rule set, computers without that endpoint would not be accessible.</span></span>

- <span data-ttu-id="51149-219">系統管理員建立了含有受限制 Runspace 的端點 **PswaEndpoint**，並想要限制特定使用者的存取權。</span><span class="sxs-lookup"><span data-stu-id="51149-219">The administrator created an endpoint with a restricted runspace called **PswaEndpoint**,and wants to restrict access to specific users.</span></span> <span data-ttu-id="51149-220">系統管理員建立了一個名為 **Level1Support** 的使用者群組，並定義下列規則：**Level1Support,\*,PswaEndpoint**。</span><span class="sxs-lookup"><span data-stu-id="51149-220">The administrator creates a group of users called **Level1Support**, and defines the following rule: **Level1Support,\*,PswaEndpoint**.</span></span> <span data-ttu-id="51149-221">這個規則可讓 **Level1Support** 群組中的所有使用者有權存取具有 **PswaEndpoint** 設定的所有電腦。</span><span class="sxs-lookup"><span data-stu-id="51149-221">The rule grants any users in the group **Level1Support** access to all computers with the **PswaEndpoint** configuration.</span></span> <span data-ttu-id="51149-222">同樣也可以限制特定電腦組的存取權。</span><span class="sxs-lookup"><span data-stu-id="51149-222">Similarly, access can be restricted to a specific set of computers.</span></span>

- <span data-ttu-id="51149-223">有些系統管理員會提供比其他使用者更多的存取權給特定使用者。</span><span class="sxs-lookup"><span data-stu-id="51149-223">Some administrators provide certain users more access than others.</span></span> <span data-ttu-id="51149-224">例如，系統管理員建立兩個使用者群組 **Admins** 和 **BasicSupport**。</span><span class="sxs-lookup"><span data-stu-id="51149-224">For example, an administrator creates two user groups, **Admins** and **BasicSupport**.</span></span> <span data-ttu-id="51149-225">系統管理員還會建立含有受限制 Runspace 的端點 **PswaEndpoint**，並定義下列兩個規則：**Admins,\*,\*** 和 **BasicSupport,\*,PswaEndpoint**。</span><span class="sxs-lookup"><span data-stu-id="51149-225">The administrator also creates an endpoint with a restricted runspace called **PswaEndpoint**, and defines the following two rules: **Admins,\*,\*** and **BasicSupport,\*,PswaEndpoint**.</span></span> <span data-ttu-id="51149-226">第一個規則可讓 **Admin** 群組中的所有使用者存取所有電腦，而第二個規則只能讓 **BasicSupport** 群組中的所有使用者存取具有 **PswaEndpoint** 的電腦。</span><span class="sxs-lookup"><span data-stu-id="51149-226">The first rule provides all users in the **Admin** group access to all computers, and the second rule provides all users in the **BasicSupport** group access only to those computers with **PswaEndpoint**.</span></span>

- <span data-ttu-id="51149-227">某系統管理員已經設定私人測試環境，且想要讓所有已獲授權的網路使用者在網路上存取他們通常可以存取的所有電腦，以及存取他們通常可以存取的所有工作階段設定。</span><span class="sxs-lookup"><span data-stu-id="51149-227">An administrator has set up a private test environment, and wants to allow all authorized network users access to all computers on the network to which they typically have access, with access to all session configurations to which they typically have access.</span></span> <span data-ttu-id="51149-228">因為這是私人測試環境，所以系統管理員建立的授權規則並不安全。</span><span class="sxs-lookup"><span data-stu-id="51149-228">Because this is a private test environment, the administrator creates an authorization rule that is not secure.</span></span> <span data-ttu-id="51149-229">- 系統管理員執行 `Add-PswaAuthorizationRule * * *` Cmdlet，其中使用萬用字元 **\*** 來代表所有使用者、所有電腦以及所有設定。</span><span class="sxs-lookup"><span data-stu-id="51149-229">- The administrator runs the cmdlet `Add-PswaAuthorizationRule * * *`, which uses the wildcard character **\*** to represent all users, all computers, and all configurations.</span></span> <span data-ttu-id="51149-230">- 這個規則相當於下列項目：`Add-PswaAuthorizationRule -UserName * -ComputerName * -ConfigurationName *`。</span><span class="sxs-lookup"><span data-stu-id="51149-230">- This rule is the equivalent of the following: `Add-PswaAuthorizationRule -UserName * -ComputerName * -ConfigurationName *`.</span></span>

  > [!NOTE]
  > <span data-ttu-id="51149-231">如需安全的環境，不建議使用這個規則，並略過 Windows PowerShell Web 存取所提供的授權規則安全性階層。</span><span class="sxs-lookup"><span data-stu-id="51149-231">This rule is not recommended in a secure environment, and bypasses the authorization rule layer of security provided by Windows PowerShell Web Access.</span></span>

- <span data-ttu-id="51149-232">系統管理員必須讓使用者在包含工作群組和網域的環境中連線到目標電腦，在這種環境中，工作群組電腦偶爾會用來連線到網域的目標電腦，而網域中的電腦偶爾也會用來連線工作群組中的目標電腦。</span><span class="sxs-lookup"><span data-stu-id="51149-232">An administrator must allow users to connect to target computers in an environment that includes both workgroups and domains, where workgroup computers are occasionally used to connect to target computers in domains, and computers in domains are occasionally used to connect to target computers in workgroups.</span></span> <span data-ttu-id="51149-233">系統管理員在工作群組中有閘道伺服器 *PswaServer*；網域中則有目標電腦 *srv1.contoso.com*。</span><span class="sxs-lookup"><span data-stu-id="51149-233">The administrator has a gateway server, *PswaServer*, in a workgroup; and target computer *srv1.contoso.com* is in a domain.</span></span> <span data-ttu-id="51149-234">使用者 *Chris* 是工作群組閘道伺服器和目標電腦上的授權本機使用者。</span><span class="sxs-lookup"><span data-stu-id="51149-234">User *Chris* is an authorized local user on both the workgroup gateway server and the target computer.</span></span> <span data-ttu-id="51149-235">他在工作群組伺服器的使用者名稱為 *chrisLocal*，而他在目標電腦的使用者名稱為 *contoso\\chris*。</span><span class="sxs-lookup"><span data-stu-id="51149-235">His user name on the workgroup server is *chrisLocal*; and his user name on the target computer is *contoso\\chris*.</span></span> <span data-ttu-id="51149-236">如果要授與 Chris 存取 srv1.contoso.com 的權限，系統管理員要新增下列規則。</span><span class="sxs-lookup"><span data-stu-id="51149-236">To authorize access to srv1.contoso.com for Chris, the administrator adds the following rule.</span></span>

```powershell
Add-PswaAuthorizationRule -userName PswaServer\chrisLocal `
   -computerName srv1.contoso.com -configurationName Microsoft.PowerShell
```

<span data-ttu-id="51149-237">之前的規則範例會在閘道伺服器驗證 Chris，然後授與他存取 *srv1* 的權限。</span><span class="sxs-lookup"><span data-stu-id="51149-237">The preceding rule example authenticates Chris on the gateway server, and then authorizes his access to *srv1*.</span></span> <span data-ttu-id="51149-238">在登入頁面上，Chris 必須在 **[選用連線設定]** 區域 (*contoso\\chris*) 中提供第二組認證。</span><span class="sxs-lookup"><span data-stu-id="51149-238">On the sign-in page, Chris must provide a second set of credentials in the **Optional connection settings** area (*contoso\\chris*).</span></span> <span data-ttu-id="51149-239">閘道伺服器會使用這組額外的認證，在目標電腦 *srv1.contoso.com* 上驗證他。</span><span class="sxs-lookup"><span data-stu-id="51149-239">The gateway server uses the additional set of credentials to authenticate him on the target computer, *srv1.contoso.com*.</span></span>

<span data-ttu-id="51149-240">在先前的案例中，Windows PowerShell Web 存取必須先成功完成下列各項且至少獲得一個授權規則的允許，才能順利建立與目標電腦的連線。</span><span class="sxs-lookup"><span data-stu-id="51149-240">In the preceding scenario, Windows PowerShell Web Access establishes a successful connection to the target computer only after the following have been successful, and allowed by at least one authorization rule.</span></span>

1. <span data-ttu-id="51149-241">利用 *server_name*\\*user_name* 格式將使用者名稱新增到授權規則，以便在工作群組閘道伺服器上進行驗證</span><span class="sxs-lookup"><span data-stu-id="51149-241">Authentication on the workgroup gateway server by adding a user name in the format *server_name*\\*user_name* to the authorization rule</span></span>

2. <span data-ttu-id="51149-242">使用登入頁面上 [選用連線設定] 區域中提供的替代認證，在目標電腦上進行驗證</span><span class="sxs-lookup"><span data-stu-id="51149-242">Authentication on the target computer by using alternate credentials provided on the sign-in page, in the **Optional connection settings** area</span></span>

   > [!NOTE]
   > <span data-ttu-id="51149-243">如果閘道與目標電腦位於不同的工作群組或網域，則必須建立兩個工作群組電腦、兩個網域或工作群組及網域間的信任關係。</span><span class="sxs-lookup"><span data-stu-id="51149-243">If gateway and target computers are in different workgroups or domains, a trust relationship must be established between the two workgroup computers, the two domains, or between the workgroup and the domain.</span></span> <span data-ttu-id="51149-244">這個關係無法使用 Windows PowerShell Web 存取授權規則 Cmdlet 進行設定。</span><span class="sxs-lookup"><span data-stu-id="51149-244">This relationship cannot be configured by using Windows PowerShell Web Access authorization rule cmdlets.</span></span> <span data-ttu-id="51149-245">授權規則無法定義電腦間的信任關係，只能授權讓使用者連線到特定目標電腦和工作階段設定。</span><span class="sxs-lookup"><span data-stu-id="51149-245">Authorization rules do not define a trust relationship between computers; they can only authorize users to connect to specific target computers and session configurations.</span></span> <span data-ttu-id="51149-246">如需如何設定不同網域間信任關係的詳細資訊，請參閱[建立網域及樹系信任](https://technet.microsoft.com/library/cc794775.aspx)。</span><span class="sxs-lookup"><span data-stu-id="51149-246">For more information about how to configure a trust relationship between different domains, see [Creating Domain and Forest Trusts](https://technet.microsoft.com/library/cc794775.aspx).</span></span>
   > <span data-ttu-id="51149-247">如需如何將工作群組電腦加入信任主機清單的詳細資訊，請參閱[使用伺服器管理員進行遠端管理](https://technet.microsoft.com/library/dd759202.aspx)。</span><span class="sxs-lookup"><span data-stu-id="51149-247">For more information about how to add workgroup computers to a trusted hosts list, see [Remote Management with Server Manager](https://technet.microsoft.com/library/dd759202.aspx).</span></span>

### <a name="using-a-single-set-of-authorization-rules-for-multiple-sites"></a><span data-ttu-id="51149-248">對多個站台使用一組授權規則</span><span class="sxs-lookup"><span data-stu-id="51149-248">Using a single set of authorization rules for multiple sites</span></span>

<span data-ttu-id="51149-249">授權規則儲存在 XML 檔案中。</span><span class="sxs-lookup"><span data-stu-id="51149-249">Authorization rules are stored in an XML file.</span></span> <span data-ttu-id="51149-250">根據預設，XML 檔案的路徑名稱是 `%windir%\Web\PowershellWebAccess\data\AuthorizationRules.xml`。</span><span class="sxs-lookup"><span data-stu-id="51149-250">By default, the path name of the XML file is `%windir%\Web\PowershellWebAccess\data\AuthorizationRules.xml`.</span></span>

<span data-ttu-id="51149-251">授權規則 XML 檔案的路徑儲存在 **powwa.config** 檔案中，您可以在 `%windir%\Web\PowershellWebAccess\data` 中找到此檔案。</span><span class="sxs-lookup"><span data-stu-id="51149-251">The path to the authorization rules XML file is stored in the **powwa.config** file, which is found in `%windir%\Web\PowershellWebAccess\data`.</span></span> <span data-ttu-id="51149-252">系統管理員可彈性變更 **powwa.config** 中預設路徑的參照，以符合喜好設定或需求。</span><span class="sxs-lookup"><span data-stu-id="51149-252">The administrator has the flexibility to change the reference to the default path in **powwa.config** to suit preferences or requirements.</span></span> <span data-ttu-id="51149-253">如有需要，系統管理員可以變更這個檔案的位置，讓多個 Windows PowerShell Web 存取閘道使用相同的授權規則。</span><span class="sxs-lookup"><span data-stu-id="51149-253">Allowing the administrator to change the location of the file lets multiple Windows PowerShell Web Access gateways use the same authorization rules, if such a configuration is desired.</span></span>

## <a name="session-management"></a><span data-ttu-id="51149-254">工作階段管理</span><span class="sxs-lookup"><span data-stu-id="51149-254">Session management</span></span>

<span data-ttu-id="51149-255">根據預設，Windows PowerShell Web 存取會將使用者限制為一次三個工作階段。</span><span class="sxs-lookup"><span data-stu-id="51149-255">By default, Windows PowerShell Web Access limits a user to three sessions at one time.</span></span> <span data-ttu-id="51149-256">您可以在 IIS Manager 中編輯 Web 應用程式的 **web.config** 檔案，以支援每位使用者不同的工作階段數目。</span><span class="sxs-lookup"><span data-stu-id="51149-256">You can edit the web application's **web.config** file in IIS Manager to support a different number of sessions per user.</span></span> <span data-ttu-id="51149-257">**web.config** 檔案的路徑為 `$Env:Windir\Web\PowerShellWebAccess\wwwroot\Web.config`。</span><span class="sxs-lookup"><span data-stu-id="51149-257">The path to the **web.config** file is `$Env:Windir\Web\PowerShellWebAccess\wwwroot\Web.config`.</span></span>

<span data-ttu-id="51149-258">根據預設，只要編輯任何設定，IIS 網頁伺服器就會重新啟動應用程式集區。</span><span class="sxs-lookup"><span data-stu-id="51149-258">By default, IIS Web Server is configured to restart the application pool if any settings are edited.</span></span> <span data-ttu-id="51149-259">例如，如果變更 **web.config** 檔案，就會重新啟動應用程式集區。</span><span class="sxs-lookup"><span data-stu-id="51149-259">For example, the application pool is restarted if changes are made to the **web.config** file.</span></span> <span data-ttu-id="51149-260">因為 **Windows PowerShell Web 存取**會使用記憶體內部工作階段狀態，所以登入 **Windows PowerShell Web 存取**工作階段的使用者會在應用程式集區重新啟動後遺失他們的工作階段。</span><span class="sxs-lookup"><span data-stu-id="51149-260">>Because **Windows PowerShell Web Access** uses in-memory session states, >users signed in to **Windows PowerShell Web Access** sessions lose their sessions when the application pool is restarted.</span></span>

### <a name="setting-default-parameters-on-the-sign-in-page"></a><span data-ttu-id="51149-261">設定登入頁面的預設參數</span><span class="sxs-lookup"><span data-stu-id="51149-261">Setting default parameters on the sign-in page</span></span>

<span data-ttu-id="51149-262">如果您的 Windows PowerShell Web 存取閘道正在 Windows Server 2012 R2 上執行，您就可以針對 Windows PowerShell Web 存取登入頁面上顯示的設定來設定預設值。</span><span class="sxs-lookup"><span data-stu-id="51149-262">If your Windows PowerShell Web Access gateway is running on Windows Server 2012 R2, you can configure default values for the settings that are displayed on the Windows PowerShell Web Access sign-in page.</span></span> <span data-ttu-id="51149-263">您可以在上一段中說明的 **web.config** 檔案中設定值。</span><span class="sxs-lookup"><span data-stu-id="51149-263">You can configure values in the **web.config** file that is described in the preceding paragraph.</span></span> <span data-ttu-id="51149-264">登入頁面設定的預設值位於 web.config 檔案的 **appSettings** 區段中；以下是 **appSettings** 區段的範例。</span><span class="sxs-lookup"><span data-stu-id="51149-264">Default values for the sign-in page settings are found in the **appSettings** section of the web.config file; the following is an example of the **appSettings** section.</span></span> <span data-ttu-id="51149-265">其中許多設定的有效值，都與 Windows PowerShell 中的 [New-PSSession](https://technet.microsoft.com/library/hh849717.aspx) Cmdlet 的對應參數相同。</span><span class="sxs-lookup"><span data-stu-id="51149-265">Valid values for many of these settings are the same as those for the corresponding parameters of the [New-PSSession](https://technet.microsoft.com/library/hh849717.aspx) cmdlet in Windows PowerShell.</span></span>

<span data-ttu-id="51149-266">例如，`defaultApplicationName` 索引鍵 (如下列程式碼區塊所示) 即為目標電腦上的 **$PSSessionApplicationName** 喜好設定變數值。</span><span class="sxs-lookup"><span data-stu-id="51149-266">For example, the `defaultApplicationName` key, as shown in the following code block, is the value of the **$PSSessionApplicationName** preference variable on the target computer.</span></span>

```xml
  <appSettings>
      <add key="maxSessionsAllowedPerUser" value="3"/>
      <add key="defaultPortNumber" value="5985"/>
      <add key="defaultSSLPortNumber" value="5986"/>
      <add key="defaultApplicationName" value="WSMAN"/>
      <add key="defaultUseSslSelection" value="0"/>
      <add key="defaultAuthenticationType" value="0"/>
      <add key="defaultAllowRedirection" value="0"/>
      <add key="defaultConfigurationName" value="Microsoft.PowerShell"/>
  </appSettings>
```

### <a name="time-outs-and-unplanned-disconnections"></a><span data-ttu-id="51149-267">逾時和非計劃的連線中斷</span><span class="sxs-lookup"><span data-stu-id="51149-267">Time-outs and unplanned disconnections</span></span>

<span data-ttu-id="51149-268">Windows PowerShell Web 存取工作階段逾時。在 Windows Server 2012 上執行的 Windows PowerShell Web 存取中，當工作階段停止活動超過 15 分鐘後，登入使用者就會看到逾時訊息。</span><span class="sxs-lookup"><span data-stu-id="51149-268">Windows PowerShell Web Access sessions time out. In Windows PowerShell Web Access running on Windows Server 2012, A time-out message is displayed to signed-in users after 15 minutes of session inactivity.</span></span> <span data-ttu-id="51149-269">如果使用者沒有在逾時訊息顯示後五分鐘內回應，該工作階段就會結束，使用者也會登出。您可以在 IIS 管理員的網站設定中，變更工作階段的逾時期間。</span><span class="sxs-lookup"><span data-stu-id="51149-269">If the user does not respond within five minutes after the time-out message is displayed, the session is ended, and the user is signed out. You can change time-out periods for sessions in the website settings in IIS Manager.</span></span>

<span data-ttu-id="51149-270">在 Windows Server 2012 R2 上執行的 Windows PowerShell Web 存取中，根據預設，工作階段會在停止活動超過 20 分鐘後逾時。</span><span class="sxs-lookup"><span data-stu-id="51149-270">In Windows PowerShell Web Access running on Windows Server 2012 R2, sessions time out, by default, after 20 minutes of inactivity.</span></span> <span data-ttu-id="51149-271">如果使用者因為網路錯誤或其他非計劃性關機或失敗 (而不是因為他們自行關閉工作階段) 而從網頁型主控台中斷工作階段的連線，Windows PowerShell Web 存取工作階段就會繼續執行且連線到目標電腦，直到用戶端的逾時期間結束為止。</span><span class="sxs-lookup"><span data-stu-id="51149-271">If users are disconnected from sessions in the web-based console because of network errors or other unplanned shutdowns or failures, and not because they have closed the sessions themselves, the Windows PowerShell Web Access sessions continue to run, connected to target computers, until the time-out period on the client side lapses.</span></span> <span data-ttu-id="51149-272">工作階段會在預設的 20 分鐘或閘道系統管理員所指定的逾時期間之後中斷連線，視何者較短而定。</span><span class="sxs-lookup"><span data-stu-id="51149-272">The session is disconnected after either the default 20 minutes, or after the time-out period specified by the gateway administrator, whichever is shorter.</span></span>

<span data-ttu-id="51149-273">如果閘道伺服器正在執行 Windows Server 2012 R2，Windows PowerShell Web 存取就能讓使用者在稍後重新連線到已儲存的工作階段，但如果工作階段是因為網路錯誤、非計劃性關機或其他失敗而中斷連線，則在閘道系統管理員指定的逾時期間結束之前，使用者將無法檢視或重新連線到已儲存的工作階段。</span><span class="sxs-lookup"><span data-stu-id="51149-273">If the gateway server is running Windows Server 2012 R2, Windows PowerShell Web Access lets users reconnect to saved sessions at a later time, but when network errors, unplanned shutdowns, or other failures disconnect sessions, users cannot see or reconnect to saved sessions until after the time-out period specified by the gateway administrator has lapsed.</span></span>

## <a name="see-also"></a><span data-ttu-id="51149-274">另請參閱</span><span class="sxs-lookup"><span data-stu-id="51149-274">See Also</span></span>

<span data-ttu-id="51149-275">[安裝和使用 Windows PowerShell Web 存取](https://technet.microsoft.com/library/hh831611(v=ws.11).aspx)</span><span class="sxs-lookup"><span data-stu-id="51149-275">[Install and Use Windows PowerShell Web Access](https://technet.microsoft.com/library/hh831611(v=ws.11).aspx)</span></span>

[<span data-ttu-id="51149-276">about_Session_Configurations</span><span class="sxs-lookup"><span data-stu-id="51149-276">about_Session_Configurations</span></span>](https://technet.microsoft.com/library/dd819508.aspx)

[<span data-ttu-id="51149-277">Windows PowerShell Web 存取 Cmdlet</span><span class="sxs-lookup"><span data-stu-id="51149-277">Windows PowerShell Web Access Cmdlets</span></span>](cmdlets/web-access-cmdlets.md)